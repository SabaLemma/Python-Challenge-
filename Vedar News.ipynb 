{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [],
   "source": [
    "import tweepy \n",
    "import numpy as np \n",
    "import pandas as pd \n",
    "from datetime import datetime \n",
    "import matplotlib.pyplot as plt \n",
    "from matplotlib import style \n",
    "style.use('ggplot')\n",
    "\n",
    "from vaderSentiment.vaderSentiment import SentimentIntensityAnalyzer \n",
    "analyzer=SentimentIntensityAnalyzer()\n",
    "\n",
    "consumer_key= '7Pe8j6ayNyx0aCIFRZCKjfFZ2'\n",
    "consumer_secret='LJtWZJtWsgb54ogSXIwgnEd8kHAdzYZvneRclbM8dGTujXuVrG'\n",
    "access_token='2479773992-WyHyGnDVdzgg1wGByRi5XOBZmxmFzoHJHXito27'\n",
    "access_token_secret='PtLYC4V5eqgPC18rSSN0QsqG6wTesFOnrSLSqiiO1t6aJ'\n",
    "\n",
    "auth= tweepy.OAuthHandler(consumer_key, consumer_secret)\n",
    "auth.set_access_token(access_token, access_token_secret)\n",
    "api = tweepy.API (auth, parser=tweepy.parsers.JSONParser())"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {
    "scrolled": false
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "{'User': '@BBC', 'Compound': 0.054787071240105546, 'Positive': 0.09157519788918206, 'Neutral': 0.06537467018469657, 'Negative': 0.8430817941952508, 'Tweet Count': 379}\n",
      "\n",
      "{'User': '@CBS', 'Compound': 0.16460603773584903, 'Positive': 0.08292075471698114, 'Neutral': 0.024362264150943395, 'Negative': 0.8927169811320754, 'Tweet Count': 265}\n",
      "\n",
      "{'User': '@CNN', 'Compound': -0.05132179226069246, 'Positive': 0.07223014256619145, 'Neutral': 0.08864358452138493, 'Negative': 0.8391079429735233, 'Tweet Count': 491}\n",
      "\n",
      "{'User': '@Fox', 'Compound': -0.06560770833333333, 'Positive': 0.06486875, 'Neutral': 0.08246666666666667, 'Negative': 0.8526687499999999, 'Tweet Count': 480}\n",
      "\n",
      "{'User': '@New York times', 'Compound': -0.9369666666666667, 'Positive': 0.0, 'Neutral': 0.5053333333333333, 'Negative': 0.49466666666666664, 'Tweet Count': 3}\n",
      "\n"
     ]
    }
   ],
   "source": [
    "target_terms=('@BBC','@CBS','@CNN','@Fox','@New York times')\n",
    "\n",
    "min_tweets=5\n",
    "max_tweets=10000\n",
    "max_followers=2500\n",
    "max_following=2500\n",
    "lang='en'\n",
    "\n",
    "counter=1\n",
    "sentiments=[]\n",
    "\n",
    "# List to hold results\n",
    "results_list = []\n",
    "\n",
    "# Loop through all target terms\n",
    "for target in target_terms:\n",
    "\n",
    "    # Variable for holding the oldest tweet\n",
    "    oldest_tweet = None\n",
    "\n",
    "    # Variables for holding sentiments\n",
    "    compound_list = []\n",
    "    positive_list = []\n",
    "    negative_list = []\n",
    "    neutral_list = []\n",
    "\n",
    "    # Loop through 10 times\n",
    "    for x in range(10):\n",
    "\n",
    "        # Run search around each tweet\n",
    "        public_tweets = api.search(\n",
    "            target, count=100, result_type=\"recent\", max_id=oldest_tweet)\n",
    "\n",
    "        # Loop through all tweets\n",
    "        for tweet in public_tweets[\"statuses\"]:\n",
    "\n",
    "            # Use filters to check if user meets conditions\n",
    "            if (tweet[\"user\"][\"followers_count\"] < max_followers\n",
    "                and tweet[\"user\"][\"statuses_count\"] > min_tweets\n",
    "                and tweet[\"user\"][\"statuses_count\"] < max_tweets\n",
    "                and tweet[\"user\"][\"friends_count\"] < max_following\n",
    "                and tweet[\"user\"][\"lang\"] == lang):\n",
    "\n",
    "                # Run Vader Analysis on each tweet\n",
    "                results = analyzer.polarity_scores(tweet[\"text\"])\n",
    "                compound = results[\"compound\"]\n",
    "                pos = results[\"pos\"]\n",
    "                neu = results[\"neu\"]\n",
    "                neg = results[\"neg\"]\n",
    "\n",
    "                # Add each value to the appropriate list\n",
    "                compound_list.append(compound)\n",
    "                positive_list.append(pos)\n",
    "                negative_list.append(neg)\n",
    "                neutral_list.append(neu)\n",
    "                \n",
    "            # Set the new oldest_tweet value\n",
    "            oldest_tweet = tweet[\"id\"] - 1\n",
    "\n",
    "    # Store the Average Sentiments\n",
    "    sentiment = {\n",
    "        \"User\": target,\n",
    "        \"Compound\": np.mean(compound_list),\n",
    "        \"Positive\": np.mean(positive_list),\n",
    "        \"Neutral\": np.mean(negative_list),\n",
    "        \"Negative\": np.mean(neutral_list),\n",
    "        \"Tweet Count\": len(compound_list)}\n",
    "\n",
    "    # Print the Sentiments\n",
    "    print(sentiment)\n",
    "    print()\n",
    "    \n",
    "    # Append news results to 'results_list'\n",
    "    results_list.append(sentiment)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Compound</th>\n",
       "      <th>Negative</th>\n",
       "      <th>Neutral</th>\n",
       "      <th>Positive</th>\n",
       "      <th>Tweet Count</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>User</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>@BBC</th>\n",
       "      <td>0.055</td>\n",
       "      <td>0.843</td>\n",
       "      <td>0.065</td>\n",
       "      <td>0.092</td>\n",
       "      <td>379</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>@CBS</th>\n",
       "      <td>0.165</td>\n",
       "      <td>0.893</td>\n",
       "      <td>0.024</td>\n",
       "      <td>0.083</td>\n",
       "      <td>265</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>@CNN</th>\n",
       "      <td>-0.051</td>\n",
       "      <td>0.839</td>\n",
       "      <td>0.089</td>\n",
       "      <td>0.072</td>\n",
       "      <td>491</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>@Fox</th>\n",
       "      <td>-0.066</td>\n",
       "      <td>0.853</td>\n",
       "      <td>0.082</td>\n",
       "      <td>0.065</td>\n",
       "      <td>480</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>@New York times</th>\n",
       "      <td>-0.937</td>\n",
       "      <td>0.495</td>\n",
       "      <td>0.505</td>\n",
       "      <td>0.000</td>\n",
       "      <td>3</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                 Compound  Negative  Neutral  Positive  Tweet Count\n",
       "User                                                               \n",
       "@BBC                0.055     0.843    0.065     0.092          379\n",
       "@CBS                0.165     0.893    0.024     0.083          265\n",
       "@CNN               -0.051     0.839    0.089     0.072          491\n",
       "@Fox               -0.066     0.853    0.082     0.065          480\n",
       "@New York times    -0.937     0.495    0.505     0.000            3"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "sentiments_df=pd.DataFrame(results_list).set_index('User').round(3)\n",
    "sentiments_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [
    {
     "ename": "SyntaxError",
     "evalue": "invalid syntax (<ipython-input-8-834ef9d2dc2b>, line 3)",
     "output_type": "error",
     "traceback": [
      "\u001b[0;36m  File \u001b[0;32m\"<ipython-input-8-834ef9d2dc2b>\"\u001b[0;36m, line \u001b[0;32m3\u001b[0m\n\u001b[0;31m    plt.scatter(x_axis,'User;, marker='O', facecolors='red','yellow','orange''black','bule' )\u001b[0m\n\u001b[0m                                       ^\u001b[0m\n\u001b[0;31mSyntaxError\u001b[0m\u001b[0;31m:\u001b[0m invalid syntax\n"
     ]
    }
   ],
   "source": [
    "sentiments_df.plot(kind=\"scatter\", x=\"Tweets Ago\", y=\"Tweet Polarity\", grid=True, figsize=(-1,1),\n",
    "              title=\"Sentiment Analysis of Media Tweet\")\n",
    "plt.scatter(x_axis,'User;, marker='O', facecolors='red','yellow','orange''black','bule' )\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.6.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
